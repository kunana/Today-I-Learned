# I/O

C++ 화면 또는 키보드와 같은 입출력 장치에서 I/O 작업을 수행하기 위해 스트림이라는 편리한 추상화를 사용한다. 스트림은 프로그램이 문자를 삽입 하거나 추출할 수 있는 개체다.

표준 C++  라이브러리에는 표준 입력 및 출력 스트림 개체가 선언된 

`<iostream>` 

헤더를 포함하고 있다.

> ### 표준 출력

기본적으로 프로그램의 표준 출력은 화면에 출력하며, cout 이라는 C++ 스트림을 사용해 접근 할 ㅜㅅ있다.

cout 은 << 과 같은 삽입 연산자와 함께 사용한다. 

endl 은 개행 문자를 생성한다. 다른 표현은 '\n' 이다. 

효율성을 위해 출력을 버퍼링 할수 있다. 이점에서 endl 과 \n 이 다르다.

전자는 버퍼를 비우지만, 후자는 버퍼를 비우지 않는다.

버퍼를 비우는 작업은 디버거 없이 디버깅 할때 크래시가 발생하는 출력을 찾아내는데 도움이 될수도있다.

반대로 파일에 많은 양의 텍스트를 기록 했을때 모든 줄마다 버퍼를 비우게 되면 I/O 가 상당히 느려지게 된다.

다행히 삽입 연산자는 우선순위가 상대적으로 낮으므로 산술 연산을 직업 작성할 수 있다.

> ### 표준 입력

cin 은 입력 장치에서 문자를 일고 저장할 변수타입의 값으로 해석한다.

> ## 파일 입출력

ofstream : 파일에쓰기
ifstream : 파일로부터 읽기
fstream : 파일 읽기 및 모두 쓰기

우리는 cin 및 cout 과 같은 방식으로 파일 스트림을 사용할 수있다. 유일한 차이점은 파일 스트림을 실제 파일과 연관시켜야 한다는 점이다. 

예를 들어
```cpp
#include <iostream>

int main()
{
    std::ofstream square_file;
    square_file.open("squares.txt");
    
    for(int i = 0; i < 10; ++i)
    {
        square_file << i << "^2 = " <<  i * i << std::endl;
    }
    square_file.close();
}
```


위 코드는 squares.txt라는 파일을 생성하고 (이미 존재하며 덮어씌움) 우리가 cout 에 쓰는 것 처럼 문장을 쓴다. 

C++는 출력 파일과 std::cout 이 만족하는 일반적인 스트림 개념을 설정한다.

이는 우리가 std::cout 에 쓸수 있는 파일에 모든것을 쓸수 잇음을 의미하며, 그 반대의 경우도 마찬가지다.

새로운 타입을 위한 operator<< 를 정의 할때 ostream 에 대해 한번만 정의하면, 콘솔, 파일 및 다른 출력 스트림에서 동작한다.

또는 스트림의 생성자에 파일 이름을 인수로 전달해 파일을 암시적으로 열 수잇다. 이파일은 square_file 이 스코프를 암시적으로 닫는다. [RAII_참고]

```cpp
#include <iostream>

int main()
{
    std::ofstream square_file("squares.txt");
    
    for(int i = 0; i < 10; ++i)
    {
        square_file << i << "^2 = " <<  i * i << std::endl;
    }
}
```

> ### 일반적인 스트림 개념

스트림은 화면, 키보드 및 파일에만 국한 하지 않는다. 모든 클래스는 istream, ostream iostream 에서 파생할 경우 스트림으로 사용 할 수잇으며, 해당 클래스의 함수에 대한 구현을 제공한다.

예를 들어

Boost.Asio 는 위의 I/O 에 대한 대안으로 TCP/IP 및 Boost.IOStream 을 제공한다.

표준 라이브러리에는 출력 가능한 모든 타입의 문자열을 만드는데 사용할 수있는 stringstream 을 포함하고 잇다. stringstream의 메소드 str()은 스트림의 내부 문자열을 반환 한다.

ostream의 레퍼런스를 인수로 사용해 모든 종류의 출력 스트림을 허용하는 출력함수를 작성 할수있다.

```cpp
#include <iostream>
#include <fstream>
#include <sstream>

void write_sth(std::ostream& os) //모든 종류의 출력 스트림을 허용하는 출력함수
{
    os << "HI stream." << std::endl;
}

int main(int argc, char const *argv[])
{
    std::ofstream myfile("example.txt");
    std::stringstream mystream;

    write_sth(std::cout); // 출력
    write_sth(myfile); // 파일 에 출력
    write_sth(mystream); // 스트림 내부 문자열에 출력.

    std::cout << "mystream is : " << mystream.str(); // 개행을 포함하고 있음
    return 0;
}
```


마찬가지로 iostream 을 사용해 일반적인 입력을 istream 및 읽기/쓰기 I/O 로 구현할수 있다.

> ### 서식 지정

I/O 스트림은 헤더 파일 

`<iomanip>` 

에 있는 소위  I/O 조작기로 서식을 지정할 수있다. 기본적으로 C++는 부종소수점의 숫자 몇자리만 출력한다. 따라서 우리는 정밀도를 높이려고 한다.

```cpp
double pi = M_PI;
cout << "pi is " << pi << '\n';
cout << "pi is " << setprecision(16)<< pi <<'\n';
```

이렇게 하면 pi 가 소수점을 포함하여 16자리까지 나올것이다. [참고_표현가능한자릿수]


